<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    

<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Watching a Directory for Changes (The Java&trade; Tutorials &gt;        
            Essential Classes &gt; Basic I/O)
</title>

     <meta name="description" content="This Java tutorial describes exceptions, basic input/output, concurrency, regular expressions, and the platform environment" />
     <meta name="keywords" content="java programming, learn java, java sample code, java exception, java input output, java threads, java regex, regular expressions, path, classpath, environment variable" />
        
<style type="text/css">
    .FigureCaption   { 
        margin-left: 1in; 
        margin-right: 1in; 
        font-family: sans-serif; 
        font-size: smaller; 
        text-align: justify;
    }
    #TopBar_bl {
        background: url(../../images/java_bar_bl.gif) 0 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        background: url(../../images/java_bar_br.gif) 100% 100% no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        background: url(../../images/java_bar_tl.gif) 0 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar_tr {
        background: url(../../images/java_bar_tr.gif) 100% 0 no-repeat;
        width: 100%;
        height: 60px;
    }
    #TopBar {
        background: #35556B url(../../images/java_bar.gif);
        margin: 10px 10px 0 10px;
        height:60px;
        min-width:700px;
        color: white;
        font-family: sans-serif; 
        font-weight: bold;
    }
    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    #TopBar_right {
        line-height: 14px;
        float: right;
        padding-top: 2px;
        padding-right: 30px;
        text-align: left;
    }
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 12px;
        margin: 3px;
        padding: 0;
    }
    #TopBar a:visited, #TopBar a:link {
        color: white;
        text-decoration: none;
    }
    #TopBar a:hover, #TopBar a:active  {
        background-color: white;
        color: #35556B;
    }
    #BreadCrumbs {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    #BreadCrumbs a {
        color: blue;
    }
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    .LeftBar_shown {
        width: 13em;
        float: left;
        margin-left: 10px;
        margin-top: 4px;
        margin-bottom: 2em;
        margin-right: 10px;
    }
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    .LeftBar_hidden {
        display: none;
    }
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }
    
    #Footer2 {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;
    }
    .NavBit  {
        padding: 4px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    @media print {
        .NavBit {
            display: none;
        }
    }
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    #Contents a, .NavBit a, #TagNotes a {
        color: blue
    }
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #F90000;
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #F90000;
        font-family: sans-serif;
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
    }
    
    .tocli {
        list-style-type:none;
    }

    .betadraft {
        color: red;
    }
</style>
<script type="text/javascript">
/* <![CDATA[ */
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }

    function showCode(displayCodePage, codePath) {
        var codePathEls = codePath.split("/");
        var currDocPathEls = location.href.split("/");
        //alert ("codePathEls = " + codePathEls + "\n" + "currDocPathEls = " + currDocPathEls);
        currDocPathEls.pop(); // remove file name at the end
        while (codePathEls.length > 0) {
            if (codePathEls[0] == "..") {
                codePathEls.shift();
                currDocPathEls.pop();
            } else {
                break;
            }
        }
        var fullCodePath = currDocPathEls.join("/") + "/" + codePathEls.join("/");
        //alert ("fullCodePath = " + fullCodePath );
        if (codePath.indexOf(".java") != -1 || codePath.indexOf(".jnlp") != -1) {
            window.location.href = displayCodePage + "?code=" + encodeURI(fullCodePath);
        } else {
            window.location.href = fullCodePath;
        }
    }
/* ]]> */    
</script>


    </head>
<body onload="load()">
    <noscript>
        A browser with JavaScript enabled is required for this page to operate properly.
    </noscript>

    <div id="TopBar"> <div id="TopBar_tr"> <div id="TopBar_tl"> <div id="TopBar_br"> <div id="TopBar_bl"> 
                        <div id="TopBar_right"> 
                            <a target="_blank"
				href="http://www.oracle.com/technetwork/java/javase/downloads/java-se-7-tutorial-2012-02-28-1536013.html">Download Ebooks</a><br />
                            <a target="_blank"
                                href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Download JDK</a>
                            <br />
                            <a href="../../search.html" target="_blank">Search Java Tutorials</a>
                            <br />
                            <a href="javascript:toggleLeft()"
                                id="ToggleLeft">Hide TOC</a>
                        </div>
                    </div> </div> </div> </div> </div>
    <div class="PrintHeaders">
        <b>Trail:</b> Essential Classes
        <br /><b>Lesson:</b> Basic I/O
        <br /><b>Section:</b> File I/O (Featuring NIO.2)
    </div>

    <div id="LeftBar" class="LeftBar_shown">
        <div id="Contents">
            <div class="linkLESSON"><a href="index.html">Basic I/O</a></div>
<div class="linkAHEAD"><a href="streams.html">I/O Streams</a></div>
<div class="linkBHEAD"><a href="bytestreams.html">Byte Streams</a></div>
<div class="linkBHEAD"><a href="charstreams.html">Character Streams</a></div>
<div class="linkBHEAD"><a href="buffers.html">Buffered Streams</a></div>
<div class="linkBHEAD"><a href="scanfor.html">Scanning and Formatting</a></div>
<div class="linkCHEAD"><a href="scanning.html">Scanning</a></div>
<div class="linkCHEAD"><a href="formatting.html">Formatting</a></div>
<div class="linkBHEAD"><a href="cl.html">I/O from the Command Line</a></div>
<div class="linkBHEAD"><a href="datastreams.html">Data Streams</a></div>
<div class="linkBHEAD"><a href="objectstreams.html">Object Streams</a></div>
<div class="linkAHEAD"><a href="fileio.html">File I/O (Featuring NIO.2)</a></div>
<div class="linkBHEAD"><a href="path.html">What Is a Path? (And Other File System Facts)</a></div>
<div class="linkBHEAD"><a href="pathClass.html">The Path Class</a></div>
<div class="linkCHEAD"><a href="pathOps.html">Path Operations</a></div>
<div class="linkBHEAD"><a href="fileOps.html">File Operations</a></div>
<div class="linkBHEAD"><a href="check.html">Checking a File or Directory</a></div>
<div class="linkBHEAD"><a href="delete.html">Deleting a File or Directory</a></div>
<div class="linkBHEAD"><a href="copy.html">Copying a File or Directory</a></div>
<div class="linkBHEAD"><a href="move.html">Moving a File or Directory</a></div>
<div class="linkBHEAD"><a href="fileAttr.html">Managing Metadata (File and File Store Attributes)</a></div>
<div class="linkBHEAD"><a href="file.html">Reading, Writing, and Creating Files</a></div>
<div class="linkBHEAD"><a href="rafs.html">Random Access Files</a></div>
<div class="linkBHEAD"><a href="dirs.html">Creating and Reading Directories</a></div>
<div class="linkBHEAD"><a href="links.html">Links, Symbolic or Otherwise</a></div>
<div class="linkBHEAD"><a href="walk.html">Walking the File Tree</a></div>
<div class="linkBHEAD"><a href="find.html">Finding Files</a></div>
<div class="nolinkBHEAD">Watching a Directory for Changes</div>
<div class="linkBHEAD"><a href="misc.html">Other Useful Methods</a></div>
<div class="linkBHEAD"><a href="legacy.html">Legacy File I/O Code</a></div>
<div class="linkAHEAD"><a href="summary.html">Summary</a></div>
<div class="linkQUESTIONS"><a href="QandE/questions.html">Questions and Exercises</a></div>
</div>
    </div>
    <div id="MainFlow" class="MainFlow_indented">
            <span id="BreadCrumbs">
                <a href="../../index.html" target="_top">Home Page</a>
                &gt;
                <a href="../index.html" target="_top">Essential Classes</a>
                &gt;
                <a href="index.html" target="_top">Basic I/O</a>
            </span>
            <div class="NavBit">
                <a target="_top" href="find.html">&laquo;&nbsp;Previous</a>&nbsp;&bull;&nbsp;<a target="_top" href="../TOC.html">Trail</a>&nbsp;&bull;&nbsp;<a target="_top" href="misc.html">Next&nbsp;&raquo;</a>
            </div>
            <div id="PageTitle"><h1>Watching a Directory for Changes</h1></div>
            <div id="PageContent">

<!-- Watching a Directory for Changes -->
<p>Have you ever found yourself editing a file, using an IDE or another editor, and a dialog box appears to inform you that one of the open files has changed on the file system and needs to be reloaded? Or perhaps, like the NetBeans IDE, the application just quietly updates the file without notifying you. The following sample dialog box shows how this notification looks with the free editor, 
<a class="OutsideLink" target="_blank" href="http://sourceforge.net/projects/jedit/">jEdit</a>:</p>
<center><img src="../../figures/essential/io-jEditDialog.png" width="496" height="310" align="bottom" alt="Sample jEdit Dialog stating: The following files were changed on disk by another program." /></p><p class="FigureCaption"><center>jEdit Dialog Box Showing That a Modified File Is Detected</center></p></center><p>To implement this functionality, called <em>file change notification</em>, a program must be able to detect what is happening to the relevant directory on the file system. One way to do so is to poll the file system looking for changes, but this approach is inefficient. It does not scale to applications that have hundreds of open files or directories to monitor.</p>
<p>The <code>java.nio.file</code> package provides a file change notification API, called the Watch Service API. This API enables you to register a directory (or directories) with the watch service. When registering, you tell the service which types of events you are interested in: file creation, file deletion, or file modification. When the service detects an event of interest, it is forwarded to the registered process. The registered process has a thread (or a pool of threads) dedicated to watching for any events it has registered for. When an event comes in, it is handled as needed.</p>
<p>This section covers the following:</p>
<ul>
<li><a href="#overview">Watch Service Overview</a></li>
<li><a href="#try">Try It Out</a></li>
<li><a href="#register">Creating a Watch Service and Registering for Events</a></li>
<li><a href="#process">Processing Events</a></li>
<li><a href="#name">Retrieving the File Name</a></li>
<li><a href="#concerns">When to Use and Not Use This API</a></li>
</ul>
<h2><a name="overview" id="overview">Watch Service Overview</a></h2>
<p>The <code>WatchService</code> API is fairly low level, allowing you to customize it. You can use it as is, or you can choose to create a high-level API on top of this mechanism so that it is suited to your particular needs.</p>
<p>Here are the basic steps required to implement a watch service:</p>
<ul>
<li>Create a <code>WatchService</code> &quot;watcher&quot; for the file system.</li>
<li>For each directory that you want monitored, register it with the watcher. When registering a directory, you specify the type of events for which you want notification. You receive a <code>WatchKey</code> instance for each directory that you register.</li>
<li>Implement an infinite loop to wait for incoming events. When an event occurs, the key is signaled and placed into the watcher&#39;s queue.</li>
<li>Retrieve the key from the watcher&#39;s queue. You can obtain the file name from the key.</li>
<li>Retrieve each pending event for the key (there might be multiple events) and process as needed.</li>
<li>Reset the key, and resume waiting for events.</li>
<li>Close the service: The watch service exits when either the thread exits or when it is closed (by invoking its <code>closed</code> method).</li>
</ul>
<p><code>WatchKeys</code> are thread-safe and can be used with the <code>java.nio.concurrent</code> package. You can dedicate a 
<a class="TutorialLink" target="_top" href="../concurrency/pools.html">thread pool</a> to this effort.</p>
<h2><a name="try" id="try">Try It Out</a></h2>
<p>Because this API is more advanced, try it out before proceeding. Save the 
<a class="SourceLink" target="_blank" href="examples/WatchDir.java" onclick="showCode('../../displayCode.html', 'examples/WatchDir.java'); return false;"><code><code>WatchDir</code></code></a> example to your computer, and compile it. Create a <code>test</code> directory that will be passed to the example. <code>WatchDir</code> uses a single thread to process all events, so it blocks keyboard input while waiting for events. Either run the program in a separate window, or in the background, as follows:</p>
<div class="codeblock"><pre>
java WatchDir test &amp;
</pre></div>
<p>Play with creating, deleting, and editing files in the <code>test</code> directory. When any of these events occurs, a message is printed to the console. When you have finished, delete the <code>test</code> directory and <code>WatchDir</code> exits. Or, if you prefer, you can manually kill the process.</p>
<p>You can also watch an entire file tree by specifying the <code>-r</code> option. When you specify <code>-r</code>, <code>WatchDir</code> 
<a class="TutorialLink" target="_top" href="walk.html">walks the file tree</a>, registering each directory with the watch service.</p>
<h2><a name="register" id="register">Creating a Watch Service and Registering for Events</a></h2>
<p>The first step is to create a new 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchService.html"><code>WatchService</code></a> by using the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileSystem.html#newWatchService--"><code>newWatchService</code></a> method in the <code>FileSystem</code> class, as follows:</p>
<div class="codeblock"><pre>
WatchService watcher = FileSystems.getDefault().newWatchService();
</pre></div>
<p>Next, register one or more objects with the watch service. Any object that implements the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/Watchable.html"><code>Watchable</code></a> interface can be registered. The <code>Path</code> class implements the <code>Watchable</code> interface, so each directory to be monitored is registered as a <code>Path</code> object.</p>
<p>As with any <code>Watchable</code>, the <code>Path</code> class implements two <code>register</code> methods. This page uses the two-argument version, 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html#register-java.nio.file.WatchService-java.nio.file.WatchEvent.Kind...-"><code>register(WatchService, WatchEvent.Kind&lt;?&gt;...)</code></a>. (The three-argument version takes a <code>WatchEvent.Modifier</code>, which is not currently implemented.)</p>
<p>When registering an object with the watch service, you specify the types of events that you want to monitor. The supported 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/StandardWatchEventKinds.html"><code>StandardWatchEventKinds</code></a> event types follow:</p>
<ul>
<li><code>ENTRY_CREATE</code> &ndash; A directory entry is created.</li>
<li><code>ENTRY_DELETE</code> &ndash; A directory entry is deleted.</li>
<li><code>ENTRY_MODIFY</code> &ndash; A directory entry is modified.</li>
<li><code>OVERFLOW</code> &ndash; Indicates that events might have been lost or discarded. You do not have to register for the <code>OVERFLOW</code> event to receive it.</li>
</ul>
<p>The following code snippet shows how to register a <code>Path</code> instance for all three event types:</p>
<div class="codeblock"><pre>
import static java.nio.file.StandardWatchEventKinds.*;

Path dir = ...;
try {
    WatchKey key = dir.register(watcher,
                           ENTRY_CREATE,
                           ENTRY_DELETE,
                           ENTRY_MODIFY);
} catch (IOException x) {
    System.err.println(x);
}
</pre></div>
<h2><a name="process" id="process">Processing Events</a></h2>
<p>The order of events in an event processing loop follow:</p>
<ol>
<li>Get a watch key. Three methods are provided:
<ul>
<li>
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchService.html#poll--"><code>poll</code></a> &ndash; Returns a queued key, if available. Returns immediately with a <code>null</code> value, if unavailable.</li>
<li>
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchService.html#poll-long-java.util.concurrent.TimeUnit-"><code>poll(long, TimeUnit)</code></a> &ndash; Returns a queued key, if one is available. If a queued key is not immediately available, the program waits until the specified time. The <code>TimeUnit</code> argument determines whether the specified time is nanoseconds, milliseconds, or some other unit of time.</li>
<li>
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchService.html#take--"><code>take</code></a> &ndash; Returns a queued key. If no queued key is available, this method waits.</li>
</ul>
</li>
<li>Process the pending events for the key. You fetch the <code>List</code> of 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchEvent.html"><code>WatchEvents</code></a>from the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchKey.html#pollEvents--"><code>pollEvents</code></a> method.</li>
<li>Retrieve the type of event by using the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchEvent.html#kind--"><code>kind</code></a> method. No matter what events the key has registered for, it is possible to receive an <code>OVERFLOW</code> event. You can choose to handle the overflow or ignore it, but you should test for it.</li>
<li>Retrieve the file name associated with the event. The file name is stored as the context of the event, so the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchEvent.html#context--"><code>context</code></a> method is used to retrieve it.</li>
<li>After the events for the key have been processed, you need to put the key back into a <code>ready</code> state by invoking 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchEvent.html#reset--"><code>reset</code></a>. If this method returns <code>false</code>, the key is no longer valid and the loop can exit. This step is very <strong>important</strong>. If you fail to invoke <code>reset</code>, this key will not receive any further events.</li>
</ol>
<p>A watch key has a state. At any given time, its state might be one of the following:</p>
<ul>
<li><code>Ready</code> indicates that the key is ready to accept events. When first created, a key is in the ready state.</li>
<li><code>Signaled</code> indicates that one or more events are queued. Once the key has been signaled, it is no longer in the ready state until the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchKey.html#reset--"><code>reset</code></a> method is invoked.</li>
<li><code>Invalid</code> indicates that the key is no longer active. This state happens when one of the following events occurs:
<ul>
<li>The process explicitly cancels the key by using the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchKey.html#cancel--"><code>cancel</code></a> method.</li>
<li>The directory becomes inaccessible.</li>
<li>The watch service is 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/WatchService.html#close--">closed</a>.</li>
</ul>
</li>
</ul>
<p>Here is an example of an event processing loop. It is taken from the 
<a class="SourceLink" target="_blank" href="examples/Email.java" onclick="showCode('../../displayCode.html', 'examples/Email.java'); return false;"><code><code>Email</code></code></a> example, which watches a directory, waiting for new files to appear. When a new file becomes available, it is examined to determine if it is a <code>text/plain</code> file by using the 
<a class="APILink" target="_blank" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#probeContentType-java.nio.file.Path-"><code>probeContentType(Path)</code></a> method. The intention is that <code>text/plain</code> files will be emailed to an alias, but that implementation detail is left to the reader.</p>
<p>The methods specific to the watch service API are shown in bold:</p>
<div class="codeblock"><pre>
for (;;) {

    // wait for key to be signaled
    WatchKey key;
    try {
        <strong>key = watcher.take()</strong>;
    } catch (InterruptedException x) {
        return;
    }

    for (WatchEvent&lt;?&gt; event: <strong>key.pollEvents()</strong>) {
        WatchEvent.Kind&lt;?&gt; <strong>kind = event.kind()</strong>;

        // This key is registered only
        // for ENTRY_CREATE events,
        // but an OVERFLOW event can
        // occur regardless if events
        // are lost or discarded.
        <strong>if (kind == OVERFLOW)</strong> {
            continue;
        }

        // The filename is the
        // context of the event.
        <strong>WatchEvent&lt;Path&gt; ev = (WatchEvent&lt;Path&gt;)event;
        Path filename = ev.context();</strong>

        // Verify that the new
        //  file is a text file.
        try {
            // Resolve the filename against the directory.
            // If the filename is "test" and the directory is "foo",
            // the resolved name is "test/foo".
            Path child = dir.resolve(filename);
            if (!Files.probeContentType(child).equals("text/plain")) {
                System.err.format("New file '%s'" +
                    " is not a plain text file.%n", filename);
                continue;
            }
        } catch (IOException x) {
            System.err.println(x);
            continue;
        }

        // Email the file to the
        //  specified email alias.
        System.out.format("Emailing file %s%n", filename);
        //Details left to reader....
    }

    // Reset the key -- this step is critical if you want to
    // receive further watch events.  If the key is no longer valid,
    // the directory is inaccessible so exit the loop.
    boolean <strong>valid = key.reset()</strong>;
    if (!valid) {
        break;
    }
}
</pre></div>
<h2><a name="name" id="name">Retrieving the File Name</a></h2>
<p>The file name is retrieved from the event context. The 
<a class="SourceLink" target="_blank" href="examples/Email.java" onclick="showCode('../../displayCode.html', 'examples/Email.java'); return false;"><code><code>Email</code></code></a> example retrieves the file name with this code:</p>
<div class="codeblock"><pre>
WatchEvent&lt;Path&gt; ev = (WatchEvent&lt;Path&gt;)event;
Path filename = ev.context();
</pre></div>
<p>When you compile the <code>Email</code> example, it generates the following error:</p>
<div class="codeblock"><pre>
Note: Email.java uses unchecked or unsafe operations.
Note: Recompile with -Xlint:unchecked for details.
</pre></div>
<p>This error is a result of the line of code that casts the <code>WatchEvent&lt;T&gt;</code> to a <code>WatchEvent&lt;Path&gt;</code>. The 
<a class="SourceLink" target="_blank" href="examples/WatchDir.java" onclick="showCode('../../displayCode.html', 'examples/WatchDir.java'); return false;"><code><code>WatchDir</code></code></a> example avoids this error by creating a utility <code>cast</code> method that suppresses the unchecked warning, as follows:</p>
<div class="codeblock"><pre>
@SuppressWarnings("unchecked")
static &lt;T&gt; WatchEvent&lt;T&gt; cast(WatchEvent&lt;?&gt; event) {
    return (WatchEvent&lt;Path&gt;)event;
}
</pre></div>
<p>If you are unfamiliar with the <code>@SuppressWarnings</code> syntax, see 
<a class="TutorialLink" target="_top" href="../../java/annotations/index.html">Annotations</a>.</p>
<h2><a name="concerns" id="concerns">When to Use and Not Use This API</a></h2>
<p>The Watch Service API is designed for applications that need to be notified about file change events. It is well suited for any application, like an editor or IDE, that potentially has many open files and needs to ensure that the files are synchronized with the file system. It is also well suited for an application server that watches a directory, perhaps waiting for <code>.jsp</code> or <code>.jar</code> files to drop, in order to deploy them.</p>
<p>This API is <em>not</em> designed for indexing a hard drive. Most file system implementations have native support for file change notification. The Watch Service API takes advantage of this support where available. However, when a file system does not support this mechanism, the Watch Service will poll the file system, waiting for events. 
</p>


        </div>
        <div class="NavBit">
            <a target="_top" href="find.html">&laquo; Previous</a>
            &bull;
            <a target="_top" href="../TOC.html">Trail</a>
            &bull;
            <a target="_top" href="misc.html">Next &raquo;</a>
        </div>
    </div>
    <div id="Footer2">
<hr />
<div id="TagNotes">
    <p class="footertext">Problems with the examples? Try <a target="_blank"
        href="../../information/run-examples.html">Compiling and Running
        the Examples: FAQs</a>.
    <br />
    Complaints? Compliments? Suggestions? <a target="_blank"
        href="http://docs.oracle.com/javase/feedback.html">Give
    us your feedback</a>.
    </p>
</div> 

<div id="Footer">
<p class="footertext"><a name="license_info">Your use of this</a> page and all the material on pages under &quot;The Java Tutorials&quot; banner 
 is subject to these <a href="../../information/cpyr.html">legal notices</a>.
</p>
<table border="0" cellspacing="0" cellpadding="5" summary="">
    <tr>
         <td width="20%">
	 <table width="100%" border="0" cellspacing="0" cellpadding="5">
            <tr>
              <td headers="h1" align="center"><img id="duke" src="../../images/DukeWave.gif" width="55" height="55" alt="duke image" /></td>
              <td headers="h2" align="left" valign="middle"><img id="oracle" src="../../images/logo_oracle_footer.gif" width="100" height="29" alt="Oracle logo" /></td>
           </tr>
          </table>
          </td>

          <td width="55%" valign="middle" align="center">
		<p class="footertext"><a href="http://www.oracle.com/us/corporate/index.html">About Oracle</a> | <a href="http://www.oracle.com/technology/index.html">Oracle Technology Network</a> | <a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a></p> 
	 </td>
          <td width="25%" valign="middle" align="right">
      		<p class="footertext">Copyright &copy; 1995, 2014 Oracle and/or its affiliates. All rights reserved.</p>
	 </td>
     </tr>     
</table>
</div>
    </div>
    <div class="PrintHeaders">
        <b>Previous page:</b> Finding Files
        <br /><b>Next page:</b> Other Useful Methods
    </div>
</body>
</html> 
